# NanoMQ Configuration 0.18.0

# #============================================================
# # NanoMQ Broker
# #============================================================

mqtt {
    property_size = 32
    max_packet_size = 10KB
    max_mqueue_len = 2048
    retry_interval = 10s
    keepalive_multiplier = 1.25
    
    # Three of below, unsupported now
    max_inflight_window = 2048
    max_awaiting_rel = 10s
    await_rel_timeout = 10s
}

listeners.tcp {
    bind = "0.0.0.0:1883"
}

# listeners.ssl {
# 	bind = "0.0.0.0:8883"
# 	keyfile = "/etc/certs/key.pem"
# 	certfile = "/etc/certs/cert.pem"
# 	cacertfile = "/etc/certs/cacert.pem"
# 	verify_peer = false
# 	fail_if_no_peer_cert = false
# }

listeners.ws {
    bind = "0.0.0.0:8083/mqtt"
}

http_server {
    port = 8081
    limit_conn = 2
    username = admin
    password = public
    auth_type = basic
    jwt {
        public.keyfile = "/etc/certs/jwt/jwtRS256.key.pub"
    }
}

log {
    to = [file, console]
    level = info
    dir = "/tmp"
    file = "nanomq.log"
    rotation {
        size = 10MB
        count = 5
    }
}

auth {
    allow_anonymous = true
    no_match = allow
    deny_action = ignore
    
    cache = {
        max_size = 32
        ttl = 1m
    }
    
    # password = {include "/etc/nanomq_pwd.conf"}
    # acl = {include "/etc/nanomq_acl.conf"}
}

# #====================================================================
# # Exchange configuration for Embedded Messaging Queue
# #====================================================================
# # Initalize multiple MQ exchanger by giving them different name (mq1)
exchange_client.mq1 {
	# # exchanges contains multiple MQ exchanger
	exchange {
		# # MQTT Topic for filtering messages and saving to queue
		topic = "topic1",
		# # MQ name
		name = "exchange_no1",
		# # MQ category. Only support Ringbus for now
		ringbus = {
			# # ring buffer name
			name = "ringbus",
			# # max length of ring buffer (msg count)
			cap = 1000,
			# #  0: RB_FULL_NONE: When the ringbus is full, no action is taken and the message enqueue fail
			# #  1: RB_FULL_DROP: When the ringbus is full, the data in the ringbus is discarded
			# #  2: RB_FULL_RETURN: When the ringbus is full, the data in the ringbus is taken out and returned to the aio
			# #  3: RB_FULL_FILE: When the ringbus is full, the data in the ringbus is written to the file
			#
			# # Value: 0-4
			# # Default: 0
			fullOp = 3
		}
	}
}





# #====================================================================
# # BLF configuration (Apply to Exchange/Messaging_Queue)
# #====================================================================
 blf {
  	# # BLF compress type.
  	# #
  	# # Value: uncompressed | snappy | gzip | brotli | zstd | lz4
  	compress = uncompressed
  
  	# # The dir for parquet files.
  	# #
  	# # Value: Folder
  	dir = "/tmp/nanomq-blf"
  	# # The prefix of parquet files written.
  	# #
  	# # Value: string
  	file_name_prefix = "ly"
  	# # Maximum rotation count of parquet files.
  	# #
  	# # Value: Number
  	# # Default: 5
  	file_count = 5
  	# # The max size of parquet file written.
  	# #
  	# # Default: 10M
  	# # Value: Number
      # # Supported Unit: KB | MB | GB
      file_size = 1MB
 }

# #====================================================================
# # Parquet configuration (Apply to Exchange/Messaging_Queue)
# #====================================================================
 parquet {
 	# # Parquet compress type.
 	# #
 	# # Value: uncompressed | snappy | gzip | brotli | zstd | lz4
 	compress = uncompressed
 	# # Encryption options
 	encryption {
 		# # Set a key retrieval metadata.
 		# #
 		# # Value: String
 		key_id = kf
 		# # Parquet encryption key.
 		# #
 		# # Value: String key must be either 16, 24 or 32 bytes.
 		key = "0123456789012345"
 		# # Set encryption algorithm. If not called, files 
 		# # will be encrypted with AES_GCM_V1 (default).
 		# #
 		# # Value: AES_GCM_CTR_V1 | AES_GCM_V1
 		type = AES_GCM_V1
 	}
 	# # The dir for parquet files.
 	# #
 	# # Value: Folder
 	dir = "/tmp/nanomq-parquet"
 	# # The prefix of parquet files written.
 	# #
 	# # Value: string
 	file_name_prefix = "ly"
 	# # Maximum rotation count of parquet files.
 	# #
 	# # Value: Number
 	# # Default: 5
 	file_count = 5
 	# # The max size of parquet file written.
 	# #
 	# # Default: 10M
 	# # Value: Number
     # # Supported Unit: KB | MB | GB
     file_size = 1MB
 }

